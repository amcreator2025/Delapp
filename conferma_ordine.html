<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ordine Inviato – Conferma</title>
  <style>
    :root{
      --bg:#fafafa; --fg:#333;
      --brand-dark:#004d40; --brand:#00796b; --brand-hover:#005f56;
      --muted:#6b7280; --card:#fff; --border:#e5e7eb;
      --shadow:0 12px 32px rgba(0,0,0,.12); --radius:18px;
      --ring:0 0 0 4px rgba(0,121,107,.14);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:'Segoe UI', system-ui, Arial, sans-serif; background:var(--bg); color:var(--fg); display:grid; grid-template-rows:auto 1fr}
    header.app{background:var(--brand-dark); color:#fff; padding:1rem}
    header.app .wrap{max-width:820px; margin:0 auto; display:flex; align-items:center; gap:12px}
    .logo{width:44px; height:44px; border-radius:12px; background:#fff; color:var(--brand-dark); display:grid; place-items:center; font-weight:800; border:1px solid #e6e6e6}
    h1.title{margin:0; font-size:1.15rem}
    .subtitle{margin:.2rem 0 0; opacity:.9; font-size:.9rem; color:#e5f6f4}
    main{display:grid; place-items:center; padding:1.5rem}
    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); width:100%; max-width:720px; overflow:hidden}
    .hero{display:flex; gap:14px; align-items:center; padding:18px 20px; border-bottom:1px solid var(--border)}
    .check{width:54px; height:54px; border-radius:999px; background:linear-gradient(135deg, var(--brand) 0%, var(--brand-dark) 100%); display:grid; place-items:center; color:#fff; box-shadow:0 8px 18px rgba(0,121,107,.35)}
    .check svg{width:28px; height:28px}
    .hero-text h2{margin:0; font-size:1.15rem}
    .hero-text p{margin:.25rem 0 0; color:var(--muted)}
    .content{display:grid; grid-template-columns:1fr 1fr; gap:14px; padding:16px}
    @media (max-width:760px){ .content{grid-template-columns:1fr} }
    .panel{border:1px solid var(--border); border-radius:14px; padding:12px}
    .panel h3{margin:.1rem 0 .4rem; font-size:1rem; color:#0b3b35}
    .row{display:flex; justify-content:space-between; gap:10px; font-size:.95rem}
    .row + .row{margin-top:.35rem}
    .muted{color:var(--muted)}
    .tag{display:inline-flex; align-items:center; gap:.35rem; background:#e0f2f1; color:#0b3b35; border:1px solid #cde9e6; border-radius:999px; padding:.25rem .6rem; font-size:.8rem}
    .items{display:grid; gap:8px; margin-top:.5rem}
    .item{display:flex; justify-content:space-between; gap:8px}
    .qty{opacity:.8; font-variant-numeric:tabular-nums}
    .total{font-weight:700}
    .actions{display:flex; gap:.6rem; justify-content:flex-end; flex-wrap:wrap; padding:14px 16px; border-top:1px solid var(--border); background:#fff}
    .btn{background:var(--brand); color:#fff; border:none; padding:.8rem 1rem; border-radius:12px; cursor:pointer; transition:background .2s, transform .04s}
    .btn:hover{background:var(--brand-hover)} .btn:active{transform:translateY(1px)}
    .btn.secondary{background:#fff; color:var(--brand-dark); border:1px solid #cbd5d6}
    .btn.ghost{background:#fff; border:1px dashed #cbd5d6; color:#111}
    /* Toast */
    #toast{position:fixed; bottom:16px; right:16px; background:#111; color:#fff; padding:10px 14px; border-radius:10px; opacity:0; transform:translateY(8px); transition:.2s; z-index:100}
    #toast.show{opacity:1; transform:none}
    /* Confetti minimale */
    .confetti{position:fixed; inset:0; pointer-events:none; overflow:hidden}
    .confetti i{position:absolute; width:8px; height:14px; background:linear-gradient(180deg,#fff,rgba(255,255,255,.3)); animation:fall 1.8s linear forwards; opacity:.9}
    @keyframes fall{ to{ transform:translateY(120vh) rotate(360deg); opacity:0 } }
  </style>
</head>
<body>
  <header class="app">
    <div class="wrap">
      <div class="logo">R</div>
      <div>
        <h1 class="title">Ordine Inviato</h1>
        <p class="subtitle">Grazie! Stiamo processando il tuo ordine.</p>
      </div>
    </div>
  </header>

  <main>
    <section class="card" id="card">
      <div class="hero">
        <div class="check" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 6L9 17l-5-5"></path>
          </svg>
        </div>
        <div class="hero-text">
          <h2>ORDINE ESEGUITO CON SUCCESSO</h2>
          <p class="muted" id="pEta">Attendi la conferma dal ristorante.</p>
        </div>
      </div>

      <div class="content">
        <div class="panel">
          <h3>Dettagli ordine</h3>
          <div class="row"><span class="muted">ID ordine</span><strong id="vId">—</strong></div>
          <div class="row"><span class="muted">Cliente</span><strong id="vCliente">—</strong></div>
          <div class="row"><span class="muted">Modalità</span><span id="vModalita" class="tag">—</span></div>
          <div class="row"><span class="muted">Contatto</span><span id="vTel">—</span></div>
          <div class="row" id="rInd"><span class="muted">Indirizzo</span><span id="vIndirizzo">—</span></div>
          <div class="row"><span class="muted">Orario</span><span id="vOrario">—</span></div>
          <div class="row"><span class="muted">Pagamento</span><span id="vPagamento">—</span></div>
          <div class="row"><span class="muted">Totale</span><span id="vTotale" class="total">—</span></div>
        </div>

        <div class="panel">
          <h3>Riepilogo articoli</h3>
          <div class="items" id="vItems"></div>
        </div>
      </div>
    </section>
  
    <div class="actions" style="display:flex;gap:.5rem;justify-content:flex-end;max-width:820px;margin:1rem auto 0;">
      <button id="btnStampa" class="btn" style="padding:.6rem 1rem;border-radius:10px;border:1px solid #e5e7eb;background:#fff;cursor:pointer">Stampa ricevuta</button>
      <button class="btn" onclick="(function(){localStorage.removeItem('cartSelezione');localStorage.removeItem('ordineCorrente');localStorage.setItem('newOrder','1');window.location.href='menu_iniziale.html';})()" style="padding:.6rem 1rem;border-radius:10px;border:1px solid #e5e7eb;background:#fff;cursor:pointer">Nuovo ordine</button>
    </div>

</main>

  <div id="toast" role="status" aria-live="polite"></div>
  <div id="confetti" class="confetti" aria-hidden="true"></div>

  <script>
    const toastEl = document.getElementById('toast');
    function toast(m){ toastEl.textContent=m; toastEl.classList.add('show'); clearTimeout(toast.t); toast.t=setTimeout(()=>toastEl.classList.remove('show'),1600); }
    function fmtEur(n){ return new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR'}).format(n||0); }

    // Recupera ultimo ordine inviato (da pendingOrders)
    function getLastOrder(){
      try{
        const arr = JSON.parse(localStorage.getItem('pendingOrders')||'[]');
        if(!arr.length) return null;
        return arr[arr.length-1];
      }catch(e){ return null; }
    }

    function render(){
      const o = getLastOrder();
      if(!o){ document.getElementById('vItems').innerHTML='<div class="muted">Nessun articolo disponibile.</div>'; return; }

      // Stima tempi base
      const isDelivery = (o.modalita||'').toLowerCase()==='consegna';
      const eta = isDelivery ? 'Consegna stimata: 45–60 min' : 'Ritiro stimato: 15–25 min';
      document.getElementById('pEta').textContent = eta;

      document.getElementById('vId').textContent = '#' + String(o.id).slice(-6);
      document.getElementById('vCliente').textContent = o.cliente || '—';
      document.getElementById('vModalita').textContent = (o.modalita||'—').toUpperCase();
      document.getElementById('vTel').textContent = o.telefono || '—';
      if(isDelivery){
        document.getElementById('vIndirizzo').textContent = o.indirizzo || '—';
      } else {
        document.getElementById('rInd').style.display='none';
      }
      document.getElementById('vOrario').textContent = o.orario || '—';
      document.getElementById('vPagamento').textContent = (o.pagamento||'Da definire').toString().toUpperCase();
      document.getElementById('vTotale').textContent = fmtEur(Number(o.totale)||0);

      // Articoli
      const list = Array.isArray(o.dettagli) ? o.dettagli : [];
      const wrap = document.getElementById('vItems'); wrap.innerHTML='';
      if(!list.length){ wrap.innerHTML='<div class="muted">Nessun articolo.</div>'; }
      list.forEach(line => {
        // prova a estrarre nome e quantità da stringhe tipo "Pizza Margherita x2 — 7.50€"
        let name = String(line), qty='×1';
        const xIdx = name.toLowerCase().lastIndexOf(' x');
        if(xIdx>0){ qty='×'+ name.slice(xIdx+2).split(' ')[0].replace(/[^0-9]/g,'') || '1'; name = name.slice(0,xIdx); }
        const el = document.createElement('div'); el.className='item';
        el.innerHTML = `<span>${name.trim()}</span><span class="qty">${qty}</span>`;
        wrap.appendChild(el);
      });

      confetti();
    }

    // Stampa ricevuta minimale
    const __btnSt = document.getElementById('btnStampa');
    if(__btnSt){ __btnSt.addEventListener('click', ()=>{
      toast('Preparazione stampa…');
      setTimeout(()=>window.print(), 250);
    });}


    // Confetti semplici
    function confetti(){
      const root = document.getElementById('confetti');
      for(let i=0;i<60;i++){
        const p=document.createElement('i');
        p.style.left = Math.random()*100 + 'vw';
        p.style.top = -10 - Math.random()*40 + 'px';
        p.style.background = i%3 ? 'linear-gradient(180deg,#e0f2f1,#ffffff)' : 'linear-gradient(180deg,#ffffff,#e0f2f1)';
        p.style.transform = 'rotate('+ (Math.random()*360) +'deg)';
        p.style.animationDelay = (Math.random()*0.9)+'s';
        p.style.animationDuration = (1.4 + Math.random()*1.1)+'s';
        root.appendChild(p);
        setTimeout(()=>p.remove(), 2200);
      }
    }

    render();
  
  document.addEventListener('DOMContentLoaded', render);
</script>
</body>
</html>